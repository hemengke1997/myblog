---
title: vueé¡¹ç›®ä¼˜åŒ–ğŸ’¥
id: vueOptimize
---

### å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨



é¦–å…ˆéœ€è¦å®‰è£…åˆ†ææ‰“åŒ…ä½“ç§¯çš„æ’ä»¶



```powershell
vue add webpack-bundle-analyzer

npm run build --report
```



`webpack-bundle-analyzer` é…ç½®



```javascript
pluginOptions: {
    webpackBundleAnalyzer: {
      openAnalyzer: false,
      analyzerPort: 9527,
      //  æ‰€æœ‰é…ç½®
      //  å¯ä»¥æ˜¯`server`ï¼Œ`static`æˆ–`disabled`ã€‚
      //  åœ¨`server`æ¨¡å¼ä¸‹ï¼Œåˆ†æå™¨å°†å¯åŠ¨HTTPæœåŠ¡å™¨æ¥æ˜¾ç¤ºè½¯ä»¶åŒ…æŠ¥å‘Šã€‚
      //  åœ¨â€œé™æ€â€æ¨¡å¼ä¸‹ï¼Œä¼šç”Ÿæˆå¸¦æœ‰æŠ¥å‘Šçš„å•ä¸ªHTMLæ–‡ä»¶ã€‚
      //  åœ¨`disabled`æ¨¡å¼ä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ’ä»¶æ¥å°†`generateStatsFile`è®¾ç½®ä¸º`true`æ¥ç”ŸæˆWebpack Stats JSONæ–‡ä»¶ã€‚
      analyzerMode: 'server',
      //  å°†åœ¨â€œæœåŠ¡å™¨â€æ¨¡å¼ä¸‹ä½¿ç”¨çš„ä¸»æœºå¯åŠ¨HTTPæœåŠ¡å™¨ã€‚
      analyzerHost: '127.0.0.1',
      //  å°†åœ¨â€œæœåŠ¡å™¨â€æ¨¡å¼ä¸‹ä½¿ç”¨çš„ç«¯å£å¯åŠ¨HTTPæœåŠ¡å™¨ã€‚
      analyzerPort: 8888, 
      //  è·¯å¾„æ†ç»‘ï¼Œå°†åœ¨`static`æ¨¡å¼ä¸‹ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶ã€‚
      //  ç›¸å¯¹äºæ†ç»‘è¾“å‡ºç›®å½•ã€‚
      reportFilename: 'report.html',
      //  æ¨¡å—å¤§å°é»˜è®¤æ˜¾ç¤ºåœ¨æŠ¥å‘Šä¸­ã€‚
      //  åº”è¯¥æ˜¯`stat`ï¼Œ`parsed`æˆ–è€…`gzip`ä¸­çš„ä¸€ä¸ªã€‚
      //  æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§â€œå®šä¹‰â€ä¸€èŠ‚ã€‚
      defaultSizes: 'parsed',
      //  åœ¨é»˜è®¤æµè§ˆå™¨ä¸­è‡ªåŠ¨æ‰“å¼€æŠ¥å‘Š
      openAnalyzer: true,
      //  å¦‚æœä¸ºtrueï¼Œåˆ™Webpack Stats JSONæ–‡ä»¶å°†åœ¨bundleè¾“å‡ºç›®å½•ä¸­ç”Ÿæˆ
      generateStatsFile: false, 
      //  å¦‚æœ`generateStatsFile`ä¸º`true`ï¼Œå°†ä¼šç”ŸæˆWebpack Stats JSONæ–‡ä»¶çš„åå­—ã€‚
      //  ç›¸å¯¹äºæ†ç»‘è¾“å‡ºç›®å½•ã€‚
      statsFilename: 'stats.json',
      //  stats.toJsonï¼ˆï¼‰æ–¹æ³•çš„é€‰é¡¹ã€‚
      //  ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`sourceï¼šfalse`é€‰é¡¹æ’é™¤ç»Ÿè®¡æ–‡ä»¶ä¸­æ¨¡å—çš„æ¥æºã€‚
      //  åœ¨è¿™é‡ŒæŸ¥çœ‹æ›´å¤šé€‰é¡¹ï¼šhttpsï¼š  //github.com/webpack/webpack/blob/webpack-1/lib/Stats.js#L21
      statsOptions: null,
      logLevel: 'info' // æ—¥å¿—çº§åˆ«ã€‚å¯ä»¥æ˜¯'ä¿¡æ¯'ï¼Œ'è­¦å‘Š'ï¼Œ'é”™è¯¯'æˆ–'æ²‰é»˜'ã€‚
    }
}
```



`vue/cli` è‡ªå¸¦å¯è§†åŒ–å‘½ä»¤ï¼š `vue ui`  å¯ä»¥æ–¹ä¾¿åœ°æŸ¥çœ‹æ‰“åŒ…çš„æƒ…å†µä»¥åŠ `webpack` é…ç½®



### å¼•å…¥ `cdn`

æ€è·¯ï¼š å°†ä¸€äº›é•¿æœŸä¸å˜çš„ä¾èµ–æˆ–å¤ªå¤§çš„ä¾èµ–ï¼Œæ”¹ä¸º `cdn` æ–¹å¼å¼•å…¥ï¼Œå¯å‡å°‘æ‰“åŒ…ä½“ç§¯

ä¼˜ç‚¹ï¼šè½½å…¥é€Ÿåº¦å¢å¿«ï¼Œæ‰“åŒ…ä½“ç§¯å‡å°

ç¼ºç‚¹ï¼š1.æœ¬åœ°å¼€å‘ä½¿ç”¨ `cdn` æ—¶ï¼ŒæŠ¥é”™å¯èƒ½çœ‹ä¸æ‡‚ã€‚2. `cdn` æœ‰å¯èƒ½ä¼šæŒ‚

å®ç°æ–¹å¼ï¼š

- - ç¬¬ä¸€ç§ï¼š æ‰‹åŠ¨åœ¨ `index.html` ä¸­åŠ å…¥ `cdn` é“¾æ¥ä»£ç 

```
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"</script>
```



- - ç¬¬äºŒç§ï¼š `webpack` ä¸­é…ç½® `cdn`ï¼Œç„¶ååœ¨ `index.html` ä¸­å¾ªç¯ç”Ÿæˆ

```javascript
// vue.config.js
const cdn = {
    externals: {
        vue: 'Vue',
        vuex: 'Vuex',
        'vue-router': 'VueRouter',
        moment: 'moment',
        echarts: 'echarts',
        nprogress: 'NProgress',
        'v-charts': 'VCharts'
    },
    css: [
        'https://cdn.jsdelivr.net/npm/v-charts/lib/style.min.css'
    ],
    js:[
      'https://cdn.jsdelivr.net/npm/moment@2.18.1/min/moment.min.js'
    ],
}

module.exports = {
    chainWebpack: config => {
        // ============æ³¨å…¥cdn start============
        config.plugin('html').tap(args => {
            // ç”Ÿäº§ç¯å¢ƒæˆ–æœ¬åœ°éœ€è¦cdnæ—¶ï¼Œæ‰æ³¨å…¥cdn
            if (isProduction || devNeedCdn) args[0].cdn = cdn
            return args
        })
        // ============æ³¨å…¥cdn end============
        
    },
    configureWebpack: config => {
        // ç”¨cdnæ–¹å¼å¼•å…¥ï¼Œåˆ™æ„å»ºæ—¶è¦å¿½ç•¥ç›¸å…³èµ„æº
        if (isProduction || devNeedCdn) config.externals = cdn.externals
    }
}
  <head>
    <!-- ä½¿ç”¨CDNçš„CSSæ–‡ä»¶ -->
    <% for (var i in htmlWebpackPlugin.options.cdn &&
    htmlWebpackPlugin.options.cdn.css) { %>
    <link
            href="<%= htmlWebpackPlugin.options.cdn.css[i] %>"
            rel="stylesheet"
    />
    <% } %>
    <!-- ä½¿ç”¨CDNçš„CSSæ–‡ä»¶ -->
  </head>
        
   ....
        
   <!-- ä½¿ç”¨CDNçš„JSæ–‡ä»¶ -->
    <% for (var i in htmlWebpackPlugin.options.cdn &&
    htmlWebpackPlugin.options.cdn.js) { %>
    <script src="<%= htmlWebpackPlugin.options.cdn.js[i] %>"></script>
    <% } %>
```



è§£å†³ç¼ºç‚¹ï¼š

- - æœ¬åœ°å¼€å‘è¿˜æ˜¯ä½¿ç”¨æœ¬åœ°ä¾èµ–ï¼Œä¸ºäº†é¿å…æ‰“åŒ…æ—¶å°†ä¾èµ–æ‰“å…¥ï¼Œåœ¨ `webpack` çš„externalsä¸­é…ç½®å¤–éƒ¨åŒ…æ•°ç»„

```javascript
externals: {
    vue: 'Vue',
    'vue-rotuer': 'VueRouter',
    jquery: 'jQuery'
}
```

- - - ä¸Šé¢çš„ä¾‹å­ã€‚å±æ€§åç§°æ˜¯ `vue-rotuer`ï¼Œè¡¨ç¤ºåº”è¯¥æ’é™¤ `import VueRouter from 'vue-rotuer'` ä¸­çš„ `vue-rotuer`  æ¨¡å—ã€‚ä¸ºäº†æ›¿æ¢è¿™ä¸ªæ¨¡å—ï¼Œ`VueRouter` çš„å€¼å°†è¢«ç”¨æ¥æ£€ç´¢ä¸€ä¸ªå…¨å±€çš„ `VueRouter` å˜é‡ã€‚æ¢å¥è¯è¯´ï¼Œå½“è®¾ç½®ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå®ƒå°†è¢«è§†ä¸ºå…¨å±€çš„
    - æ³¨æ„äº‹é¡¹ï¼š `cdn` ç‰ˆæœ¬éœ€è·Ÿæœ¬åœ°ä¾èµ–ç‰ˆæœ¬ä¸€è‡´



### å›¾ç‰‡å‹ç¼©

æ’ä»¶ï¼š [`image-webpack-loader`](https://github.com/tcoopman/image-webpack-loader)

```javascript
//vue.config.js

chainWebpack: (config)=>{
      // å›¾ç‰‡å‹ç¼©
      config.module
        .rule('images')
        .use('file-loader')
        .loader('file-loader')
        .end()
        .use('image-webpack-loader')
        .loader('image-webpack-loader')
        .options({
          bypassOnDebug: true
        })
        .end()
        .use('url-loader')
        .loader('url-loader')
        .tap(options => Object.assign(options, { limit: 3072 }))
       
}
```

å›¾ç‰‡å‹ç¼©åœ¨æœ¬åœ°æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯åœ¨æˆ‘å¸æœåŠ¡å™¨ä¸Šä¼šå‡ºé—®é¢˜ï¼Œæ‰€ä»¥ç›®å‰æ˜¯æ‰‹åŠ¨å‹ç¼©å›¾ç‰‡

- - è“æ¹–ä¸‹è½½åˆ‡å›¾çš„æ—¶å€™é€‰æ‹©å‹ç¼©å›¾ç‰‡
  - `tinypng` å‹ç¼©

### æ­£å¼ç¯å¢ƒå…³é—­ `sourcemap`



```
productionSourceMap: false,
```



### ç§»é™¤ `prefetch`ã€`preload`



ä»¥ä¸Šä¸¤ä¸ªæ’ä»¶æ˜¯ `vue` è‡ªå¸¦çš„æ’ä»¶ï¼Œä¼šå½±å“é¦–å±çš„æ¸²æŸ“é€Ÿåº¦ï¼Œåˆ é™¤æ–¹æ³•ï¼š



```javascript
// vue.config.js
chainWebpack: (config) => {
    config.plugins.delete('prefetch')
    config.plugins.delete('preload')
}
```



### ç¦æ­¢ç¼“å­˜



æ¨äº†æµ‹è¯•ä¹‹åï¼Œäº§å“æ€»æ˜¯è¯´ï¼šè¿˜æ²¡æ¨æµ‹è¯•å—ï¼Ÿ å“¦ æ˜¯æµè§ˆå™¨ç¼“å­˜äº†ã€‚è¿™æ ·ä¸è¡Œå“¦ï¼Œå¦‚æœç”¨æˆ·çš„æµè§ˆå™¨ä¹Ÿç¼“å­˜äº†ï¼Œé‚£å²‚ä¸æ˜¯æ›´æ–°ç­‰äºæ²¡æ›´æ–°äº†ã€‚



ç¦æ­¢ç¼“å­˜å¾ˆç®€å•ï¼Œç»™æ‰“åŒ…ä¹‹åçš„jsæ–‡ä»¶åŠ ä¸€äº›åç¼€ï¼Œä¸€èˆ¬æ˜¯ç”¨hash



```javascript
chainWebpack: (config) => {
    config.output.filename('js/[name].[hash:8].js').chunkFilename('js/[name].[hash:8].js')
}
```



### åˆ†åŒ…

ç›®çš„ï¼š æŠŠä¸€äº›é‡å¤æ‰“åŒ…çš„æ–‡ä»¶ï¼Œæ‰“åŒ…ä¸ºä¸€ä¸ªï¼Œé¿å…é‡å¤æ‰“åŒ…ã€‚æŠŠä¸€äº›é•¿æœŸä¸å˜åŒ–çš„åŒ…åˆ†åˆ°ä¸€ä¸ªåŒ…ä¸­ï¼Œåˆ©äºç¼“å­˜ã€‚

```javascript
config
    .optimization.splitChunks({
    chunks: 'all',
    cacheGroups: {
        // mand-mobileæŒ‰éœ€å¼•å…¥ ä¸éœ€è¦æ‰“åŒ…æ•´ä¸ª
        // mandMobile: {
        //   name: 'chunk-mandMobile',
        //   priority: 15,
        //   test: /[\\/]node_modules[\\/]_?mand-mobile(.*)/
        // },
        //æ¶‰åŠvueçš„æ¨¡å—
        vue: {
            test: /[\\/]node_modules[\\/](vue|vuex|vue-router)/,
            priority: 10,
            name: 'vue',
            reuseExistingChunk: true
        },
        vendors: {
            test: /[\\/]node_modules[\\/]/,
            priority: 9,
            name: 'vendors',
            reuseExistingChunk: true
        },

        cityJson: {
            name: 'chunk-city.json',
            test: resolve('src/utils/city.json'),
            minChunks: 1, // å¼•å…¥çš„æ¬¡æ•°å¤§äºç­‰äº1æ—¶æ‰è¿›è¡Œä»£ç åˆ†å‰²
            priority: 8, // ä¼˜å…ˆçº§ã€‚ æ ¹æ®ä¼˜å…ˆçº§å†³å®šæ‰“åŒ…åˆ°å“ªä¸ªç»„é‡Œ,æ‰“åŒ…åˆ°ä¼˜å…ˆçº§é«˜çš„ç»„é‡Œã€‚
            reuseExistingChunk: true, // //å¦‚æœä¸€ä¸ªæ¨¡å—å·²ç»è¢«æ‰“åŒ…è¿‡äº†,é‚£ä¹ˆå†æ‰“åŒ…æ—¶å°±å¿½ç•¥è¿™ä¸ªä¸Šæ¨¡å—
        },
    }
})
```





### å®Œæ•´é…ç½®

```javascript
const path = require('path')
const poststylus = require('poststylus')
const pxtorem = require('postcss-pxtorem')


// è§£å†³å†…å­˜æ³„æ¼çš„é—®é¢˜
// https://github.com/vuejs/vue-cli/issues/4352
require('events').EventEmitter.defaultMaxListeners = 50;


process.env.VUE_APP_BASE_URL_TYPE = process.env.NODE_ENV
const notDev = process.env.NODE_ENV !== 'development'
const isProd = process.env.NODE_ENV === 'production'

const resolve = file => path.join(__dirname, file)

//ä»£ç†é…ç½®
const baseUrl = '/xdnphb/';
const proxyData = {
  '/api/custom/yzPlatform/oss': {
    target: 'http://test.api.newrank.cn',
    changeOrigin: true,
    '^/api/custom/yzPlatform/oss': '/api/custom/yzPlatform/oss',
  },
};
const urlList = ['common', 'ade', 'user', 'pay', 'aly', 'knowledgepay', 'account', 'login', 'flowPacket'];
for (let i = 0, len = urlList.length; i < len; i++) {
  let str = urlList[i];
  let proxyPath = baseUrl + str;
  let proxyRewrite = '^' + proxyPath;

  if (str !== 'common' && str !== 'account') {
    proxyData[proxyPath] = {
      target: 'http://test.a.newrank.cn' + proxyPath,
      changeOrigin: true,
      pathRewrite: {}
    };
  } else {
    proxyData[proxyPath] = {
      target: 'http://test.main.newrank.cn' + proxyPath,
      changeOrigin: true,
      pathRewrite: {}
    };
  }

  proxyData[proxyPath].pathRewrite[proxyRewrite] = '';
}


module.exports = {
  // åŸºæœ¬è·¯å¾„
  publicPath: '/taskmobile/',
  // æ„å»ºç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œç”Ÿäº§ç¯å¢ƒçš„æ–‡ä»¶ç›®å½•
  outputDir: resolve('dist/taskmobile'),
  // eslint-loader æ˜¯å¦åœ¨ä¿å­˜çš„æ—¶å€™æ£€æŸ¥
  lintOnSave: false,
  chainWebpack: (config) => {
    // config
    //   .plugin('webpack-bundle-analyzer')
    //   .use(require('webpack-bundle-analyzer').BundleAnalyzerPlugin)
    config.module
      .rule('svg')
      .exclude.add(resolve('src/assets/svgIcon'))
      .end()
    config.module
      .rule('icons')
      .test(/\.svg$/)
      .include.add(resolve('src/assets/svgIcon'))
      .end()
      .use('svg-sprite-loader')
      .loader('svg-sprite-loader')
      .end()
    if (isProd) {
      // ä¿®æ”¹minicssæ’ä»¶ (å¿½ç•¥csså¼•å…¥é¡ºåºè­¦å‘Š)
      config.plugin('extract-css').tap(options => {
        options[0].ignoreOrder = true
        return options
      })
    }
    if (notDev) {
      // å›¾ç‰‡å‹ç¼©
      // config.module
      //   .rule('images')
      //   .use('file-loader')
      //   .loader('file-loader')
      //   .end()
      //   .use('image-webpack-loader')
      //   .loader('image-webpack-loader')
      //   .options({
      //     mozjpeg: {
      //       enabled: false
      //     },
      //     gifsicle: {
      //       enabled: false
      //     },
      //     optipng: {
      //       enabled: false,
      //     },
      //     pngquant: {
      //       enabled: false,
      //     },
      //     svgo: {
      //     }
      //   })
      // å…ˆå¤„ç†èµ„æºï¼Œ å†å‹ç¼©å›¾ç‰‡ 
      config.module
        .rule("images")
        .use('url-loader')
        .loader('url-loader')
        .tap(options => Object.assign(options, { limit: 3072 }))



      // ä¼˜åŒ–é¦–å±æ¸²æŸ“é€Ÿåº¦
      // ç§»é™¤ prefetch æ’ä»¶
      config.plugins.delete('prefetch')
      // ç§»é™¤ preload æ’ä»¶
      config.plugins.delete('preload');
      // ç¦æ­¢æµè§ˆå™¨ç¼“å­˜
      //è®¾ç½®æ‰“åŒ…åjsç›®å½•ï¼Œå¹¶æ·»åŠ hash
      config.output.filename('js/[name].[hash:8].js').chunkFilename('js/[name].[hash:8].js')

      config
        .optimization.splitChunks({
          chunks: 'all',
          cacheGroups: {
            // mand-mobileæŒ‰éœ€å¼•å…¥ ä¸éœ€è¦æ‰“åŒ…æ•´ä¸ª
            // mandMobile: {
            //   name: 'chunk-mandMobile',
            //   priority: 15,
            //   test: /[\\/]node_modules[\\/]_?mand-mobile(.*)/
            // },
            //æ¶‰åŠvueçš„æ¨¡å—
            vue: {
              test: /[\\/]node_modules[\\/](vue|vuex|vue-router)/,
              priority: 10,
              name: 'vue',
              reuseExistingChunk: true
            },
            vendors: {
              test: /[\\/]node_modules[\\/]/,
              priority: 9,
              name: 'vendors',
              reuseExistingChunk: true
            },

            cityJson: {
              name: 'chunk-city.json',
              test: resolve('src/utils/city.json'),
              minChunks: 1, // å¼•å…¥çš„æ¬¡æ•°å¤§äºç­‰äº1æ—¶æ‰è¿›è¡Œä»£ç åˆ†å‰²
              priority: 8, // ä¼˜å…ˆçº§ã€‚ æ ¹æ®ä¼˜å…ˆçº§å†³å®šæ‰“åŒ…åˆ°å“ªä¸ªç»„é‡Œ,æ‰“åŒ…åˆ°ä¼˜å…ˆçº§é«˜çš„ç»„é‡Œã€‚
              reuseExistingChunk: true, // //å¦‚æœä¸€ä¸ªæ¨¡å—å·²ç»è¢«æ‰“åŒ…è¿‡äº†,é‚£ä¹ˆå†æ‰“åŒ…æ—¶å°±å¿½ç•¥è¿™ä¸ªä¸Šæ¨¡å—
            },
          }
        })
    }


  },
  configureWebpack: (config) => {
    if (notDev) {
      // æ­£å¼ç¯å¢ƒç¦æ­¢console/debugger
      const terserWebpackPlugin = config.optimization.minimizer[0];
      const { terserOptions } = terserWebpackPlugin.options;
      terserOptions.compress.drop_console = true;
      terserOptions.compress.drop_debugger = true;
    }

    // if (notDev) { // å¼€å‘ç¯å¢ƒé…ç½®
    //   config.devtool = 'cheap-module-eval-source-map'
    // } else { // ç”Ÿäº§ç¯å¢ƒé…ç½®

    //     //ç”Ÿäº§ç¯å¢ƒ æ–‡ä»¶å¼€å¯Gzip
    //     config.plugins.push(
    //         new CompressionPlugin({
    //             filename: '[path].gz[query]',
    //             algorithm: 'gzip',
    //             test: new RegExp('\\.(' + ['js', 'css'].join('|') + ')$', ),
    //             threshold: 10240,
    //             minRatio: 0.8,
    //         })
    //     )
    // }
    // å¼€å‘ç”Ÿäº§å…±åŒé…ç½®
    Object.assign(config, {
      resolve: {
        extensions: ['.js', '.json', '.vue'],
        alias: {
          '@': resolve('src'),
        }
      },
      externals: {
        'moment': 'moment',
        'echarts': 'echarts'
      }
    })
  },
  css: {
    loaderOptions: {
      sass: {
        prependData: '@import "@/assets/scss/variable.scss";'
      },
      stylus: {
        use: [
          poststylus([
            pxtorem({
              rootValue: 100,
              propWhiteList: ['dontvw'],
              minPixelValue: 2
            }),
            'autoprefixer'
          ])
        ],
        import: [
          resolve('./src/assets/theme/theme.custom')
        ]
      },
      postcss: {
        plugins: [
          require('postcss-pxtorem')({
            rootValue: 100,
            propWhiteList: [],
            minPixelValue: 2
          }),
          require('autoprefixer')()
        ]
      }
    }
  },
  devServer: {
    open: process.platform === 'darwin',
    host: 'dev.a.newrank.cn',
    port: 8091,
    https: false,
    hotOnly: false,
    proxy: proxyData, // è®¾ç½®ä»£ç†
    before: app => { }
  },
  transpileDependencies: [
    'mand-mobile'
  ]
}
```

### ä¼˜åŒ–ç»“æœ

- é¡¹ç›®ä½“ç§¯ä»9MBä¼˜åŒ–åˆ°äº†2MBä¸åˆ°